<!doctype html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>EuroTech Network</title>
    <!-- Website Icon -->
    <link rel="icon" href="light_bulb.png">
    <!-- File containing CSS style-->
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Table containing information about Eurotech Universities-->
    <script type="text/javascript" src="universities.json"></script>
    <!-- Table containing information about Country Indexes-->
    <script type="text/javascript" src="country_indexes.json"></script>
    <!-- Table containing information about Startups-->
    <script type="text/javascript" src="startups.json"></script>
    <!-- Table containing information about Companies-->
    <!--<script type="text/javascript" src="startups.json"></script>-->
    <!-- Table containing information about Research Centers-->
    <script type="text/javascript" src="research.json"></script>
    <!-- TaffyDb facilitates code to use SQL queries to manipulate the tables from the DB-->
    <script src="taffy.js"></script>
    <!-- Piece of code taken from "(add website)" to generate the Radar Chart-->
    <script src="radarChart.js"></script>
    <!-- Import d3 libraries-->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-array.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script charset="utf-8" src="http://d3js.org/topojson.v1.min.js"></script>
</head>

<body>
    <!--Map View-->
    <div id="map_container" class="map_block">
        <svg class="map" id="map1" viewBox="320 130 250 150">
            <g class="mapRoot"></g>
        </svg>
    </div>
    <!--Add layer panel-->
    <div class='context-wrapper' id="wrapper">
        <div class="dropdown">
            <button onclick="dropdownFunction()" class="dropbtn">Add Layer <i class="fa fa-caret-down"></i></button>
            <div id="myDropdown" class="dropdown-content">
                <a id="su_tab" class="ddbutton">Startups</a>
                <a id="co_tab" class="ddbutton">Companies</a>
                <a id="rc_tab" class="ddbutton">Research Centers</a>
            </div>
        </div>
        <div class='radio' style="top:25px">
            <input id="first" type="radio" value="None" name="cont" checked>
            <label class="context" for="None">None</label>
        </div>
        <div class='radio' style="top:45px">
            <input id="second" type="radio" value="Population" name="cont">
            <label class="context" for="Population">Population</label>
        </div>
        <div class='radio' style="top:65px">
            <input id="third" type="radio" value="Income" name="cont">
            <label class="context" for="Income">Income per Capita</label>
        </div>
        <div class='radio' style="top:85px">
            <input id="fourth" type="radio" value="Spending" name="cont">
            <label class="context" for="Spending">Spending on RD</label>
        </div>
    </div>
    <!--Dashboard-->
    <div id="DB" class="dashboard">
        <!--Title-->
        <h1>EuroTech entrepreneurial ecosystems</h1>
        <!--Focus Field View-->
        <div class="container">
            <!--Buttons-->
            <button id="ei_Button" title="Entrepreneurship & Innovation" class="field_button" style="background-color:#98C6EA">
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 54 54" style="enable-background:new 0 0 54 54;" xml:space="preserve">
	<path d="M27,8c-9.374,0-17,7.626-17,17c0,7.112,4.391,13.412,11,15.9V50c0,0.553,0.447,1,1,1h1v2c0,0.553,0.447,1,1,1h6
		c0.553,0,1-0.447,1-1v-2h1c0.553,0,1-0.447,1-1v-9.1c6.609-2.488,11-8.788,11-15.9C44,15.626,36.374,8,27,8z M30,49
		c-0.553,0-1,0.447-1,1v2h-4v-2c0-0.553-0.447-1-1-1h-1v-5h8v5H30z M31.688,39.242C31.277,39.377,31,39.761,31,40.192V42h-8v-1.808
		c0-0.432-0.277-0.815-0.688-0.95C16.145,37.214,12,31.49,12,25c0-8.271,6.729-15,15-15s15,6.729,15,15
		C42,31.49,37.855,37.214,31.688,39.242z"></path>
	<path d="M27,6c0.553,0,1-0.447,1-1V1c0-0.553-0.447-1-1-1s-1,0.447-1,1v4C26,5.553,26.447,6,27,6z"></path>
	<path d="M51,24h-4c-0.553,0-1,0.447-1,1s0.447,1,1,1h4c0.553,0,1-0.447,1-1S51.553,24,51,24z"></path>
	<path d="M7,24H3c-0.553,0-1,0.447-1,1s0.447,1,1,1h4c0.553,0,1-0.447,1-1S7.553,24,7,24z"></path>
	<path d="M43.264,7.322l-2.828,2.828c-0.391,0.391-0.391,1.023,0,1.414c0.195,0.195,0.451,0.293,0.707,0.293
		s0.512-0.098,0.707-0.293l2.828-2.828c0.391-0.391,0.391-1.023,0-1.414S43.654,6.932,43.264,7.322z"></path>
	<path d="M12.15,38.436l-2.828,2.828c-0.391,0.391-0.391,1.023,0,1.414c0.195,0.195,0.451,0.293,0.707,0.293
		s0.512-0.098,0.707-0.293l2.828-2.828c0.391-0.391,0.391-1.023,0-1.414S12.541,38.045,12.15,38.436z"></path>
	<path d="M41.85,38.436c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414l2.828,2.828c0.195,0.195,0.451,0.293,0.707,0.293
		s0.512-0.098,0.707-0.293c0.391-0.391,0.391-1.023,0-1.414L41.85,38.436z"></path>
	<path d="M12.15,11.564c0.195,0.195,0.451,0.293,0.707,0.293s0.512-0.098,0.707-0.293c0.391-0.391,0.391-1.023,0-1.414l-2.828-2.828
		c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414L12.15,11.564z"></path>
	<path d="M27,13c-6.617,0-12,5.383-12,12c0,0.553,0.447,1,1,1s1-0.447,1-1c0-5.514,4.486-10,10-10c0.553,0,1-0.447,1-1
		S27.553,13,27,13z"></path>
</svg>
        </button>
            <button id="hbe_Button" title="Health & Bio Engineering" class="field_button" style="background-color:#A2AD00">
        <svg height="511pt" viewBox="1 0 511.99937 511" width="511pt" xmlns="http://www.w3.org/2000/svg"><path d="m470.910156 132.183594c-4.90625 4.90625-10.007812 8.890625-15.382812 12.054687l-87.273438-87.277343c3.164063-5.371094 7.144532-10.472657 12.054688-15.382813 9.382812-9.382813 9.382812-24.652344-.003906-34.039063-9.382813-9.382812-24.652344-9.386718-34.039063 0-39.0625 39.0625-39.632813 86.28125-32.796875 128.914063-49.628906-10.230469-104.492188-14.582031-148.289062 29.210937-19.796876 19.800782-31.179688 43.054688-34.796876 71.097657-.53125 4.113281 2.375 7.878906 6.488282 8.410156 4.101562.53125 7.878906-2.375 8.40625-6.488281 3.179687-24.625 13.160156-45.035156 30.523437-62.398438 40.351563-40.351562 91.328125-34.542968 140.558594-23.867187 1.46875 7.355469 2.769531 13.125 4.203125 19.464843-48.914062-11.125-96.289062-18.988281-132.015625 17.253907-79.859375 79.972656 55.839844 216.40625-33.429687 305.675781-3.527344 3.527344-9.269532 3.527344-12.796876 0-3.53125-3.527344-3.53125-9.269531 0-12.796875 56.605469-56.609375 6.027344-137.929687 2.0625-215.785156-.214843-4.140625-3.710937-7.335938-7.882812-7.117188-4.144531.210938-7.332031 3.742188-7.121094 7.882813.824219 16.148437 3.566406 32.332031 6.585938 46.957031-42.632813-6.832031-89.847656-6.261719-128.910156 32.796875-9.40625 9.402344-9.410157 24.632812 0 34.039062 9.40625 9.410157 24.632812 9.410157 34.042968 0 4.90625-4.90625 10.007813-8.886718 15.378906-12.050781l87.277344 87.273438c-3.167968 5.375-7.148437 10.476562-12.054687 15.382812-9.386719 9.382813-9.386719 24.65625 0 34.039063 9.382812 9.386718 24.652343 9.386718 34.039062 0 39.0625-39.0625 39.632813-86.28125 32.796875-128.914063 56.648438 11.675781 107.269532 11.808594 148.289063-29.210937 43.796875-43.796875 39.4375-98.667969 29.207031-148.296875 14.25 2.265625 28.5625 3.636719 42.972656 3.183593 4.144532-.132812 7.398438-3.601562 7.269532-7.746093-.132813-4.144531-3.59375-7.414063-7.742188-7.269531-13.460938.421874-28.160156-.839844-45.949219-3.976563-1.445312-6.339844-2.851562-12.3125-4.433593-19.179687 41.660156 8.386718 81.3125 10.851562 113.382812-21.21875 3.527344-3.527344 9.265625-3.527344 12.796875 0 3.539063 3.535156 3.539063 9.261718 0 12.796874-14.050781 14.054688-29.921875 23.179688-48.515625 27.894532-4.019531 1.019531-6.453125 5.101562-5.433594 9.125 1.019532 4.019531 5.105469 6.453125 9.125 5.433594 21.289063-5.398438 39.425782-15.808594 55.445313-31.832032 4.546875-4.546875 7.050781-10.589844 7.050781-17.019531 0-21.378906-26.015625-32.09375-41.089844-17.019531zm-440.433594 237.984375c-3.539062 3.539062-9.261718 3.539062-12.800781 0-3.535156-3.535157-3.539062-9.257813 0-12.796875 24.324219-24.324219 52.839844-31.640625 81.199219-31.640625 13.714844 0 27.398438 1.710937 40.550781 4.039062 1.433594 6.304688 2.894531 12.503907 4.433594 19.183594-41.660156-8.390625-81.3125-10.855469-113.382813 21.214844zm40.753907-7.921875c20.378906-6.261719 44.753906-3.867188 76.214843 2.796875 6.667969 31.460937 9.0625 55.835937 2.796876 76.214843zm116.449219-37.433594c-5.726563-24.730469-10.792969-47.792969-10.570313-68.660156l79.226563 79.226562c-20.867188.222656-43.929688-4.839844-68.65625-10.566406zm87.921874 8.59375-96.519531-96.519531c2.386719-11.390625 7.101563-21.96875 15.078125-31.625l113.0625 113.066406c-9.652344 7.980469-20.226562 12.691406-31.621094 15.078125zm42.246094-25.695312-113.066406-113.066407c9.652344-7.976562 20.230469-12.691406 31.621094-15.078125l96.519531 96.519532c-2.386719 11.390624-7.097656 21.96875-15.074219 31.625zm6.480469-119.550782c5.726563 24.730469 10.789063 47.792969 10.570313 68.660156l-79.226563-79.226562c20.863281-.222656 43.929687 4.839844 68.65625 10.566406zm11.875 148.527344c-40.351563 40.351562-91.324219 34.542969-140.558594 23.867188-1.058593-5.28125-2.210937-10.722657-4.203125-19.464844 49.542969 11.269531 95.941406 18.820312 131.964844-17.203125 79.328125-79.324219-55.277344-216.96875 33.484375-305.726563 3.527344-3.527344 9.265625-3.53125 12.796875 0 3.527344 3.527344 3.527344 9.269532 0 12.796875-79.78125 79.78125 55.757812 216.492188-33.484375 305.730469zm28.359375-188.757812c-6.667969-31.460938-9.0625-55.835938-2.796875-76.214844l79.011719 79.011718c-20.378906 6.265626-44.753906 3.871094-76.214844-2.796874zm0 0"></path></svg> 
        
        </button>
            <button id="sum_Button" title="Smart & Urban Mobility" class="field_button" style="background-color:#DAD7CB">
            <svg height="512pt" viewBox="0 0 512.001 512" width="512pt" xmlns="http://www.w3.org/2000/svg"><path d="m391.632812 136.046875c-5.976562 0-11.941406.445313-17.832031 1.328125.882813-5.890625 1.328125-11.855469 1.328125-17.832031 0-65.917969-53.625-119.542969-119.542968-119.542969-30.492188 0-59.523438 11.484375-81.753907 32.332031-20.339843 19.078125-33.234375 44.324219-36.78125 71.710938-.503906-.003907-1.007812-.007813-1.503906-.007813-74.742187 0-135.546875 60.804688-135.546875 135.546875 0 39.714844 17.335938 77.296875 47.5625 103.113281.148438.125.300781.238282.453125.347657v160.628906c0 4.144531 3.359375 7.503906 7.503906 7.503906s7.5-3.359375 7.5-7.503906v-200.570313h121.042969v200.570313c0 4.144531 3.359375 7.503906 7.503906 7.503906 4.140625 0 7.5-3.359375 7.5-7.503906v-288.597656h113.039063v288.597656c0 4.144531 3.359375 7.503906 7.503906 7.503906s7.5-3.359375 7.5-7.503906v-200.570313h121.042969v81.441407c0 4.144531 3.359375 7.503906 7.503906 7.503906s7.5-3.359375 7.5-7.503906v-33.261719c.28125-.160156.5625-.324219.824219-.527344 29.992187-22.828125 47.191406-57.519531 47.191406-95.167968.003906-65.914063-53.621094-119.539063-119.539063-119.539063zm71.527344 195.78125v-36.226563c0-4.144531-3.359375-7.503906-7.503906-7.503906h-128.542969v-80.527344c0-4.144531-3.359375-7.5-7.503906-7.5h-24.507813v-64.523437c0-4.144531-3.359374-7.503906-7.503906-7.503906-4.144531 0-7.5 3.359375-7.5 7.503906v64.523437h-17.007812v-104.539062c0-4.140625-3.359375-7.5-7.503906-7.5-4.140626 0-7.5 3.359375-7.5 7.5v104.539062h-17.007813v-64.523437c0-4.144531-3.359375-7.503906-7.5-7.503906-4.144531 0-7.503906 3.359375-7.503906 7.503906v64.523437h-24.507813c-4.144531 0-7.503906 3.355469-7.503906 7.5v80.527344h-128.542969c-4.144531 0-7.503906 3.359375-7.503906 7.503906v26.851563c-21.109375-22.289063-33.007813-51.851563-33.007813-82.871094 0-66.464843 54.074219-120.542969 120.539063-120.542969 2.492187 0 5.113281.089844 7.792969.261719 4.125.261719 7.683594-2.859375 7.964844-6.980469 3.71875-54.566406 49.527343-97.316406 104.28125-97.316406 57.640624 0 104.539062 46.894532 104.539062 104.539063 0 8.632812-1.0625 17.234375-3.152344 25.554687-1.355468 5.402344 3.703125 10.460938 9.105469 9.105469 8.320313-2.089844 16.921875-3.152344 25.558594-3.152344 57.640625 0 104.535156 46.894531 104.535156 104.535157-.003906 29.289062-11.917969 56.527343-33.011719 76.242187zm0 0"></path><path d="m407.640625 47.84375c31.164063 0 56.519531 25.355469 56.519531 56.519531 0 4.140625 3.355469 7.5 7.5 7.5 4.144532 0 7.503906-3.359375 7.503906-7.5 0-39.441406-32.085937-71.527343-71.523437-71.527343-4.144531 0-7.503906 3.359374-7.503906 7.503906 0 4.144531 3.359375 7.503906 7.503906 7.503906zm0 0"></path><path d="m407.640625 15.003906c49.269531 0 89.355469 40.085938 89.355469 89.359375 0 4.140625 3.359375 7.5 7.503906 7.5s7.5-3.359375 7.5-7.5c0-57.546875-46.816406-104.363281-104.359375-104.363281-4.144531 0-7.503906 3.359375-7.503906 7.503906 0 4.140625 3.359375 7.5 7.503906 7.5zm0 0"></path><path d="m407.640625 79.855469c13.511719 0 24.507813 10.992187 24.507813 24.507812 0 4.140625 3.359374 7.5 7.503906 7.5 4.140625 0 7.5-3.359375 7.5-7.5 0-21.789062-17.726563-39.515625-39.511719-39.515625-4.144531 0-7.503906 3.359375-7.503906 7.503906 0 4.144532 3.359375 7.503907 7.503906 7.503907zm0 0"></path><path d="m455.65625 411.878906c-4.144531 0-7.503906 3.359375-7.503906 7.503906v84.289063c0 4.144531 3.359375 7.503906 7.503906 7.503906s7.503906-3.359375 7.503906-7.503906v-84.289063c0-4.144531-3.359375-7.503906-7.503906-7.503906zm0 0"></path><path d="m287.597656 232.078125c-4.144531 0-7.5 3.359375-7.5 7.503906v64.023438c0 4.140625 3.355469 7.5 7.5 7.5 4.144532 0 7.503906-3.359375 7.503906-7.5v-64.023438c0-4.144531-3.359374-7.503906-7.503906-7.503906zm0 0"></path><path d="m255.585938 232.078125c-4.140626 0-7.5 3.359375-7.5 7.503906v64.023438c0 4.140625 3.359374 7.5 7.5 7.5 4.144531 0 7.503906-3.359375 7.503906-7.5v-64.023438c0-4.144531-3.359375-7.503906-7.503906-7.503906zm0 0"></path><path d="m223.578125 232.078125c-4.144531 0-7.503906 3.359375-7.503906 7.503906v64.023438c0 4.140625 3.359375 7.5 7.503906 7.5 4.140625 0 7.5-3.359375 7.5-7.5v-64.023438c0-4.144531-3.359375-7.503906-7.5-7.503906zm0 0"></path><path d="m287.597656 336.113281c-4.144531 0-7.5 3.359375-7.5 7.503907v64.023437c0 4.140625 3.355469 7.5 7.5 7.5 4.144532 0 7.503906-3.359375 7.503906-7.5v-64.023437c0-4.144532-3.359374-7.503907-7.503906-7.503907zm0 0"></path><path d="m255.585938 336.113281c-4.140626 0-7.5 3.359375-7.5 7.503907v64.023437c0 4.140625 3.359374 7.5 7.5 7.5 4.144531 0 7.503906-3.359375 7.503906-7.5v-64.023437c0-4.144532-3.359375-7.503907-7.503906-7.503907zm0 0"></path><path d="m223.578125 336.113281c-4.144531 0-7.503906 3.359375-7.503906 7.503907v64.023437c0 4.140625 3.359375 7.5 7.503906 7.5 4.140625 0 7.5-3.359375 7.5-7.5v-64.023437c0-4.144532-3.359375-7.503907-7.5-7.503907zm0 0"></path><path d="m287.597656 440.148438c-4.144531 0-7.5 3.359374-7.5 7.503906v56.019531c0 4.144531 3.355469 7.503906 7.5 7.503906 4.144532 0 7.503906-3.359375 7.503906-7.503906v-56.019531c0-4.144532-3.359374-7.503906-7.503906-7.503906zm0 0"></path><path d="m255.585938 440.148438c-4.140626 0-7.5 3.359374-7.5 7.503906v56.019531c0 4.144531 3.359374 7.503906 7.5 7.503906 4.144531 0 7.503906-3.359375 7.503906-7.503906v-56.019531c0-4.144532-3.359375-7.503906-7.503906-7.503906zm0 0"></path><path d="m223.578125 440.148438c-4.144531 0-7.503906 3.359374-7.503906 7.503906v56.019531c0 4.144531 3.359375 7.503906 7.503906 7.503906 4.140625 0 7.5-3.359375 7.5-7.503906v-56.019531c0-4.144532-3.359375-7.503906-7.5-7.503906zm0 0"></path><path d="m423.644531 320.109375c-4.144531 0-7.503906 3.359375-7.503906 7.503906v24.007813c0 4.140625 3.359375 7.5 7.503906 7.5s7.503907-3.359375 7.503907-7.5v-24.007813c0-4.144531-3.359376-7.503906-7.503907-7.503906zm0 0"></path><path d="m391.632812 320.109375c-4.144531 0-7.5 3.359375-7.5 7.503906v24.007813c0 4.140625 3.355469 7.5 7.5 7.5 4.144532 0 7.503907-3.359375 7.503907-7.5v-24.007813c0-4.144531-3.359375-7.503906-7.503907-7.503906zm0 0"></path><path d="m359.625 320.109375c-4.144531 0-7.503906 3.359375-7.503906 7.503906v24.007813c0 4.140625 3.359375 7.5 7.503906 7.5s7.5-3.359375 7.5-7.5v-24.007813c0-4.144531-3.355469-7.503906-7.5-7.503906zm0 0"></path><path d="m423.644531 384.132812c-4.144531 0-7.503906 3.355469-7.503906 7.5v24.007813c0 4.144531 3.359375 7.503906 7.503906 7.503906s7.503907-3.359375 7.503907-7.503906v-24.007813c0-4.144531-3.359376-7.5-7.503907-7.5zm0 0"></path><path d="m391.632812 384.132812c-4.144531 0-7.5 3.355469-7.5 7.5v24.007813c0 4.144531 3.355469 7.503906 7.5 7.503906 4.144532 0 7.503907-3.359375 7.503907-7.503906v-24.007813c0-4.144531-3.359375-7.5-7.503907-7.5zm0 0"></path><path d="m359.625 384.132812c-4.144531 0-7.503906 3.355469-7.503906 7.5v24.007813c0 4.144531 3.359375 7.503906 7.503906 7.503906s7.5-3.359375 7.5-7.503906v-24.007813c0-4.144531-3.355469-7.5-7.5-7.5zm0 0"></path><path d="m423.644531 448.152344c-4.144531 0-7.503906 3.359375-7.503906 7.503906v24.007812c0 4.144532 3.359375 7.503907 7.503906 7.503907s7.503907-3.359375 7.503907-7.503907v-24.007812c0-4.144531-3.359376-7.503906-7.503907-7.503906zm0 0"></path><path d="m391.632812 448.152344c-4.144531 0-7.5 3.359375-7.5 7.503906v24.007812c0 4.144532 3.355469 7.503907 7.5 7.503907 4.144532 0 7.503907-3.359375 7.503907-7.503907v-24.007812c0-4.144531-3.359375-7.503906-7.503907-7.503906zm0 0"></path><path d="m359.625 448.152344c-4.144531 0-7.503906 3.359375-7.503906 7.503906v24.007812c0 4.144532 3.359375 7.503907 7.503906 7.503907s7.5-3.359375 7.5-7.503907v-24.007812c0-4.144531-3.355469-7.503906-7.5-7.503906zm0 0"></path><path d="m87.53125 320.109375c-4.144531 0-7.503906 3.359375-7.503906 7.503906v24.007813c0 4.140625 3.359375 7.5 7.503906 7.5s7.503906-3.359375 7.503906-7.5v-24.007813c0-4.144531-3.359375-7.503906-7.503906-7.503906zm0 0"></path><path d="m119.542969 320.109375c-4.144531 0-7.503907 3.359375-7.503907 7.503906v24.007813c0 4.140625 3.359376 7.5 7.503907 7.5 4.140625 0 7.5-3.359375 7.5-7.5v-24.007813c0-4.144531-3.359375-7.503906-7.5-7.503906zm0 0"></path><path d="m151.550781 320.109375c-4.140625 0-7.5 3.359375-7.5 7.503906v24.007813c0 4.140625 3.359375 7.5 7.5 7.5 4.144531 0 7.503907-3.359375 7.503907-7.5v-24.007813c0-4.144531-3.359376-7.503906-7.503907-7.503906zm0 0"></path><path d="m87.53125 384.132812c-4.144531 0-7.503906 3.355469-7.503906 7.5v24.007813c0 4.144531 3.359375 7.503906 7.503906 7.503906s7.503906-3.359375 7.503906-7.503906v-24.007813c0-4.144531-3.359375-7.5-7.503906-7.5zm0 0"></path><path d="m119.542969 384.132812c-4.144531 0-7.503907 3.355469-7.503907 7.5v24.007813c0 4.144531 3.359376 7.503906 7.503907 7.503906 4.140625 0 7.5-3.359375 7.5-7.503906v-24.007813c0-4.144531-3.359375-7.5-7.5-7.5zm0 0"></path><path d="m151.550781 384.132812c-4.140625 0-7.5 3.355469-7.5 7.5v24.007813c0 4.144531 3.359375 7.503906 7.5 7.503906 4.144531 0 7.503907-3.359375 7.503907-7.503906v-24.007813c0-4.144531-3.359376-7.5-7.503907-7.5zm0 0"></path><path d="m87.53125 448.152344c-4.144531 0-7.503906 3.359375-7.503906 7.503906v24.007812c0 4.144532 3.359375 7.503907 7.503906 7.503907s7.503906-3.359375 7.503906-7.503907v-24.007812c0-4.144531-3.359375-7.503906-7.503906-7.503906zm0 0"></path><path d="m119.542969 448.152344c-4.144531 0-7.503907 3.359375-7.503907 7.503906v24.007812c0 4.144532 3.359376 7.503907 7.503907 7.503907 4.140625 0 7.5-3.359375 7.5-7.503907v-24.007812c0-4.144531-3.359375-7.503906-7.5-7.503906zm0 0"></path><path d="m151.550781 448.152344c-4.140625 0-7.5 3.359375-7.5 7.503906v24.007812c0 4.144532 3.359375 7.503907 7.5 7.503907 4.144531 0 7.503907-3.359375 7.503907-7.503907v-24.007812c0-4.144531-3.359376-7.503906-7.503907-7.503906zm0 0"></path></svg>
        </button>
            <button id="dse_Button" title="Data Science & Engineering" class="field_button" style="background-color:#E37222">
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 480.182 480.182" style="enable-background:new 0 0 480.182 480.182;" xml:space="preserve">
<g>
	<g>
		<path d="M200.182,32.106c-92.784,0-168,75.216-168,168s75.216,168,168,168s168-75.216,168-168
			C368.081,107.364,292.924,32.207,200.182,32.106z M200.182,48.106c49.416,0.039,95.723,24.123,124.128,64.56l-20,20
			c-4.867-2.945-10.439-4.521-16.128-4.56c-17.673,0-32,14.327-32,32c0.028,5.695,1.595,11.276,4.536,16.152l-52.384,52.384
			c-9.919-6.048-22.385-6.048-32.304,0l-36.384-36.384c2.941-4.876,4.508-10.457,4.536-16.152
			c0.022-17.638-14.258-31.954-31.896-31.976c-14.587-0.018-27.332,9.849-30.968,23.976h-29.68
			C66.785,98.159,128.614,48.211,200.182,48.106z M304.182,160.106c0,8.837-7.163,16-16,16s-16-7.163-16-16s7.163-16,16-16
			S304.182,151.269,304.182,160.106z M208.182,256.106c0,8.837-7.163,16-16,16s-16-7.163-16-16c0-8.837,7.163-16,16-16
			S208.182,247.269,208.182,256.106z M128.182,176.106c0,8.837-7.163,16-16,16s-16-7.163-16-16s7.163-16,16-16
			S128.182,167.269,128.182,176.106z M274.036,333.012c-22.592,12.544-48.012,19.116-73.854,19.093
			c-83.89,0.057-151.943-67.902-152-151.792c-0.004-5.414,0.282-10.825,0.856-16.208h32.28c3.637,14.085,16.317,23.945,30.864,24
			c5.695-0.028,11.276-1.595,16.152-4.536l36.384,36.384c-2.941,4.876-4.508,10.457-4.536,16.152c0,17.673,14.327,32,32,32
			s32-14.327,32-32c-0.028-5.695-1.595-11.276-4.536-16.152l52.384-52.384c4.876,2.941,10.457,4.508,16.152,4.536
			c17.673,0,32-14.327,32-32c-0.028-5.695-1.595-11.276-4.536-16.152l17.44-17.432C373.801,199.849,347.363,292.298,274.036,333.012
			z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M400.182,80.106c14.547-0.055,27.227-9.914,30.864-24h49.136v-16h-49.136c-3.637-14.086-16.317-23.945-30.864-24
			c-17.673,0-32,14.327-32,32c0.028,5.695,1.595,11.276,4.536,16.152l-14.056,14.056C291.407-9.307,165.855-25.817,78.234,41.438
			S-25.897,234.246,41.358,321.867c63.484,82.707,179.855,102.77,267.368,46.095l24.144,24.144l11.312,11.312l64.4,64.4
			c16.379,16.379,42.933,16.379,59.312,0c16.379-16.379,16.379-42.933,0-59.312l-64.4-64.4l-11.312-11.312l-24.144-24.144
			c42.859-66.016,42.859-151.071,0-217.088l16-16C388.911,78.504,394.49,80.074,400.182,80.106z M400.182,32.106
			c8.837,0,16,7.163,16,16s-7.163,16-16,16s-16-7.163-16-16S391.346,32.106,400.182,32.106z M456.582,419.818
			c10.246,10.016,10.433,26.442,0.417,36.688c-10.016,10.246-26.442,10.433-36.688,0.417c-0.141-0.137-0.279-0.276-0.417-0.417
			l-64.4-64.4l36.688-36.688L456.582,419.818z M380.87,344.106l-36.688,36.688l-22.144-22.144c1.128-0.864,2.184-1.816,3.296-2.704
			s2.4-1.952,3.592-2.952c1.752-1.472,3.48-2.96,5.176-4.488c0.872-0.8,1.704-1.6,2.56-2.4c3.28-3.072,6.456-6.248,9.528-9.528
			c0.8-0.856,1.6-1.688,2.4-2.56c1.528-1.696,3.016-3.424,4.488-5.176c1.003-1.184,1.987-2.381,2.952-3.592
			c0.88-1.104,1.832-2.16,2.696-3.288L380.87,344.106z M349.846,306.946c-2.52,3.52-5.12,6.968-7.864,10.288
			c-0.8,0.968-1.656,1.904-2.48,2.856c-2.448,2.848-4.976,5.611-7.584,8.288c-1.136,1.173-2.291,2.328-3.464,3.464
			c-2.667,2.608-5.429,5.136-8.288,7.584c-0.952,0.8-1.888,1.672-2.856,2.48c-3.32,2.744-6.768,5.344-10.288,7.864
			c-82.816,59.165-197.915,39.992-257.08-42.824S9.95,109.031,92.766,49.866S290.681,9.873,349.846,92.69
			C395.627,156.772,395.627,242.864,349.846,306.946z"></path>
	</g>
</g>

</svg>
        </button>
            <button id="hpc_Button" title="High Performance Computing" class="field_button" style="background-color:#387780">
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 480.119 480.119" style="enable-background:new 0 0 480.119 480.119;" xml:space="preserve">
<g>
	<g>
		<path d="M423.239,120.119c-5.838-0.005-11.642,0.888-17.208,2.648c0.528-4.195,0.795-8.42,0.8-12.648
			C405.792,48.272,354.813-1.023,292.965,0.016c-45.131,0.758-85.397,28.534-102.134,70.455
			C158.463,50.4,115.953,60.37,95.883,92.738c-6.534,10.537-10.106,22.641-10.34,35.037c-8.714-5.031-18.602-7.673-28.664-7.656
			c-30.928,0-56,25.072-56,56c0,30.928,25.072,56,56,56c4.418,0,8-3.582,8-8s-3.582-8-8-8
			c-22.089-0.359-39.704-18.556-39.345-40.645c0.359-22.089,18.556-39.704,40.645-39.345c13.446,0.219,25.882,7.179,33.1,18.525
			c2.42,3.697,7.378,4.732,11.075,2.313c3.195-2.091,4.467-6.148,3.037-9.689c-2.519-6.076-3.834-12.583-3.872-19.16
			c0.321-28.992,24.048-52.253,53.04-52c12.918,0.051,25.38,4.78,35.08,13.312c3.33,2.904,8.384,2.558,11.287-0.772
			c0.787-0.902,1.361-1.97,1.681-3.124c14.638-50.936,67.796-80.361,118.731-65.723c40.442,11.622,68.595,48.236,69.437,90.307
			c-0.034,8.386-1.205,16.729-3.48,24.8c-1.183,4.257,1.308,8.667,5.565,9.85c2.303,0.64,4.772,0.217,6.731-1.154
			c6.92-4.88,15.181-7.498,23.648-7.496c22.091,0,40,17.909,40,40s-17.909,40-40,40c-4.418,0-8,3.582-8,8s3.582,8,8,8
			c30.928,0,56-25.072,56-56C479.239,145.191,454.167,120.119,423.239,120.119z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M376.039,304.119h-272c-13.255,0-24,10.745-24,24v32c0,13.255,10.745,24,24,24h272c13.255,0,24-10.745,24-24v-32
			C400.039,314.864,389.294,304.119,376.039,304.119z M384.039,360.119c0,4.418-3.582,8-8,8h-272c-4.418,0-8-3.582-8-8v-32
			c0-4.418,3.582-8,8-8h272c4.418,0,8,3.582,8,8V360.119z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M353.847,328.615c-8.525,0.053-15.408,6.978-15.408,15.503c0.04,8.584,7.016,15.517,15.6,15.504
			c8.563-0.053,15.461-7.037,15.408-15.6C369.394,335.46,362.41,328.562,353.847,328.615z M354.039,344.623
			c-0.24,0-0.4-0.264-0.4-0.504l0.4-0.496V344.623z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M270.439,336.119h-152c-4.418,0-8,3.582-8,8s3.582,8,8,8h152c4.418,0,8-3.582,8-8S274.858,336.119,270.439,336.119z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M319.839,336.119h-21.28c-4.418,0-8,3.582-8,8s3.582,8,8,8h21.28c4.418,0,8-3.582,8-8S324.258,336.119,319.839,336.119z"
			></path>
	</g>
</g>
<g>
	<g>
		<path d="M376.039,400.119h-272c-13.255,0-24,10.745-24,24v32c0,13.255,10.745,24,24,24h272c13.255,0,24-10.745,24-24v-32
			C400.039,410.864,389.294,400.119,376.039,400.119z M384.039,456.119c0,4.418-3.582,8-8,8h-272c-4.418,0-8-3.582-8-8v-32
			c0-4.418,3.582-8,8-8h272c4.418,0,8,3.582,8,8V456.119z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M353.847,424.615c-8.525,0.053-15.408,6.978-15.408,15.503c0.04,8.584,7.016,15.517,15.6,15.504
			c8.563-0.053,15.461-7.037,15.408-15.6C369.394,431.46,362.41,424.562,353.847,424.615z M354.039,440.623
			c-0.24,0-0.4-0.264-0.4-0.504l0.4-0.496V440.623z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M270.439,432.119h-152c-4.418,0-8,3.582-8,8s3.582,8,8,8h152c4.418,0,8-3.582,8-8S274.858,432.119,270.439,432.119z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M319.839,432.119h-21.28c-4.418,0-8,3.582-8,8s3.582,8,8,8h21.28c4.418,0,8-3.582,8-8S324.258,432.119,319.839,432.119z"
			></path>
	</g>
</g>
<g>
	<g>
		<path d="M376.039,208.119h-272c-13.255,0-24,10.745-24,24v32c0,13.255,10.745,24,24,24h272c13.255,0,24-10.745,24-24v-32
			C400.039,218.864,389.294,208.119,376.039,208.119z M384.039,264.119c0,4.418-3.582,8-8,8h-272c-4.418,0-8-3.582-8-8v-32
			c0-4.418,3.582-8,8-8h272c4.418,0,8,3.582,8,8V264.119z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M366.935,245.935c-1.542-8.499-9.681-14.139-18.18-12.597c-4.027,0.73-7.607,3.01-9.972,6.349
			c-2.375,3.352-3.303,7.517-2.576,11.56c1.346,7.447,7.825,12.865,15.392,12.872c0.874-0.001,1.746-0.073,2.608-0.216
			c4.108-0.678,7.769-2.986,10.152-6.4C366.742,254.151,367.671,249.98,366.935,245.935z M351.191,248.751l0.36-0.632l0.04,1
			C351.231,249.119,351.207,248.919,351.191,248.751z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M268.839,240.119h-152c-4.418,0-8,3.582-8,8s3.582,8,8,8h152c4.418,0,8-3.582,8-8S273.258,240.119,268.839,240.119z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M314.727,240.119h-21.28c-4.418,0-8,3.582-8,8s3.582,8,8,8h21.28c4.418,0,8-3.582,8-8S319.146,240.119,314.727,240.119z"
			></path>
	</g>
</g>
<g>
	<g>
		<path d="M205.695,130.463l-24-24c-3.124-3.123-8.188-3.123-11.312,0l-24,24c-3.069,3.178-2.981,8.243,0.197,11.312
			c3.1,2.994,8.015,2.994,11.115,0l10.344-10.344v52.688c0,4.418,3.582,8,8,8s8-3.582,8-8v-52.688l10.344,10.344
			c3.178,3.069,8.243,2.981,11.312-0.197C208.689,138.478,208.689,133.563,205.695,130.463z"></path>
	</g>
</g>
<g>
	<g>
		<path d="M333.499,154.463c-3.1-2.994-8.015-2.994-11.116,0l-10.344,10.344v-52.688c0-4.418-3.582-8-8-8s-8,3.582-8,8v52.688
			l-10.344-10.344c-3.178-3.07-8.242-2.982-11.312,0.196c-2.994,3.1-2.994,8.015,0,11.116l24,24c3.124,3.123,8.188,3.123,11.312,0
			l24-24C336.765,162.597,336.677,157.532,333.499,154.463z"></path>
	</g>
</g>

</svg>
        </button>
        </div>
        <!--Statistics View-->
        <div id="statistics" class="info_block" style="max-height: inherit">
            <h3 id="blockTitle"></h3>
            <button class="section" style="width:30%" onclick="openTab(event, 'Startups')">Startups</button>
            <button class="section" style="width:40%" onclick="openTab(event, 'RC')">Research Centers</button>
            <button class="section" style="width:30%" onclick="openTab(event, 'Companies')">Companies</button>
            
            <div id="statistical_charts" class="content">
                <p id="intro" class="introd">Choose one of the fields of interest above to get information</p>
                <div id="slideBox" class="slideshow-container">
                    <div class="mySlides fade" id="su_radar_chart"></div>
                    <div class="mySlides fade" id="su_line_chart"></div>
                    <a id="arr_p" class="prev" onclick="plusSlides(-1)">&#10094;</a>
                    <a id="arr_n" class="next" onclick="plusSlides(1)">&#10095;</a>
                </div>
            </div>

        </div>
    </div>
    <button id="info_Button" title="More information" class="info_button">
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 65 65" style="enable-background:new 0 0 65 65;" xml:space="preserve">
            <g>
	<g>
		<path d="M32.5,0C14.58,0,0,14.579,0,32.5S14.58,65,32.5,65S65,50.421,65,32.5S50.42,0,32.5,0z M32.5,61C16.785,61,4,48.215,4,32.5
			S16.785,4,32.5,4S61,16.785,61,32.5S48.215,61,32.5,61z"></path>
		<circle cx="33.018" cy="19.541" r="3.345"></circle>
		<path d="M32.137,28.342c-1.104,0-2,0.896-2,2v17c0,1.104,0.896,2,2,2s2-0.896,2-2v-17C34.137,29.237,33.241,28.342,32.137,28.342z
			"></path>
	</g>
</g>

</svg>
        </button>
    <script>
        //VARIABLES

        //Variables from files (extracted using TaffyDB) used to draw map elements
        //Read "universities.json" File
        var universities_list = TAFFY(universities);
        //Create arrays containing the information of each column
        var name_univ = universities_list().select("name");
        var images_univ = universities_list().select("image");
        var loc_univ = universities_list().select("location");
        var short_form = universities_list().select("short_form");
        var countries_univ = universities_list().select("country");
        var coords_univ = [];
        for (var i = 0; i < loc_univ.length; i++) {
            lat_univ = parseFloat(loc_univ[i].split(",")[0]);
            lon_univ = parseFloat(loc_univ[i].split(",")[1]);
            coords_univ.push([lon_univ, lat_univ]);
        }
        //Read "country_indexes.json" File
        var countries_list = TAFFY(country_i);
        //Create arrays containing the information of each column, necessary for the "Add layer" feature
        var country = countries_list().select("country").splice(0, 5);
        var population = countries_list().select("population");
        var income = countries_list().select("income");
        var sf_age = countries_list().select("sf_age");
        var sf_female = countries_list().select("sf_female");
        var sf_male = countries_list().select("sf_male");
        var sf_none = countries_list().select("sf_none");
        var sf_bachelor = countries_list().select("sf_bachelor");
        var sf_master = countries_list().select("sf_master");
        var sf_doctoral = countries_list().select("sf_doctoral");
        var company_spending_rd = countries_list().select("company_spending_rd");
        var u_i_collaboration = countries_list().select("u_i_collaboration");
        var spending_rd = countries_list().select("spending_rd");
        var researchers_per_million = countries_list().select("researchers_per_million");
        var researcher_female = countries_list().select("researcher_female_per_million");
        var researcher_male = countries_list().select("researcher_male_per_million");
        var researcher_total = countries_list().select("researcher_total");

        //Map View
        var width_map = 1200;
        var height_map = 1200;
        var projection = d3.geoAzimuthalEqualArea(); //Map projection
        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0); //Variable used to draw the map
        var pathGenerator = d3.geoPath()
            .projection(projection); //Variable used to draw the map using a certain map projection 
        var legend_right = d3.select(null); //Variable used to adapt legend on the bottom right 
        var ls_w = 5, //Width of squares used in legends
            ls_h = 5; //Height of squares used in legends
        var active = d3.select(null); //Variable used to zoom in and out 
        var zoom = d3.zoom()
            .scaleExtent([1, 8])
            .extent([
                [0, 0],
                [width_map, height_map]
            ])
            .on("zoom", zoomed); //Variable used to zoom in and out
        var points = d3.select(null); //Variable used to draw each university in its location
        var lines = d3.select(null); //Variable used to draw lines between universities
        var circles = d3.select(null); //Variable used to draw donut charts that appear when the website is opened and proportional circles once a field of interest is chosen
        var radius = 12; //Variable used to draw donut charts
        var arc = d3.arc()
            .innerRadius(8)
            .outerRadius(radius); // Variable used to compute the position of each group on the donut
        var range = []; // Variable used to define radius of proportional circles
        var label = []; // Variable used to define labels of proportional circles

        //Reads geojson file containing European country borders and draws the map
        d3.json('ne_10m_admin_0_countries.geojson', function(error, geometry) {
            projection.fitExtent([
                [-250, -250],
                [width_map - 150, height_map - 100]
            ], geometry);
            var st = 0;
            drawMap(geometry.features, fillDefault);

            // Resets choropleth map when Buttons on the Focus Field View are clicked - No data by default
            d3.select(".container").on("click", function() {
                drawMap(geometry.features, fillDefault);
                st = 0;
            });

            // Define parameters for choropleth map depending on the selected option in the "Add Layer" panel - Always "None" (no data)for the "first" 
            d3.select("#first").on("click", function() {
                drawMap(geometry.features, fillDefault);
            });

            // Define parameters for choropleth map depending on the selected option in the "Add Layer" panel - "second, "third," and "fourth" content depends on what has been chosen on the dropdown menu of the same panel: st refers to its state and uses 0 for default options, 1 for parameters related to Startups, 2 for parameters related to Companies, and 3 ("else" in the function) for parameters related to Research Centers
            d3.select("#second").on("click", function() {
                if (st == 0) {
                    drawMap(geometry.features, fillPopulation);
                } else if (st == 1) {
                    drawMap(geometry.features, fillSFAge);
                } else if (st == 2) {
                    drawMap(geometry.features, fillUIC);
                } else {
                    drawMap(geometry.features, fillNumRes);
                }
            });
            d3.select("#third").on("click", function() {
                if (st == 0) {
                    drawMap(geometry.features, fillIncome);
                } else if (st == 1) {
                    drawMap(geometry.features, fillSFFem);
                } else if (st == 2) {
                    drawMap(geometry.features, fillCSpending);
                } else {
                    drawMap(geometry.features, fillFemRes);
                }
            });
            d3.select("#fourth").on("click", function() {
                if (st == 0) {
                    drawMap(geometry.features, fillSpending);
                } else if (st == 1) {
                    drawMap(geometry.features, fillSFMal);
                } else if (st == 2) {
                    drawMap(geometry.features, fillDefault);
                } else {
                    drawMap(geometry.features, fillMalRes);
                }
            });

            //Updates value of the variable "st" to update the "Add layer" panel when an option of the dropdown menu is selected - Resets the choropleth map to the default option: no data - checks "None" on the panel
            d3.select("#su_tab").on("click", function() {
                st = 1;
                drawMap(geometry.features, fillDefault);
                document.getElementById("first").checked = true;
            });

            d3.select("#co_tab").on("click", function() {
                st = 2;
                drawMap(geometry.features, fillDefault);
                document.getElementById("first").checked = true;
            });

            d3.select("#rc_tab").on("click", function() {
                st = 3;
                drawMap(geometry.features, fillDefault);
                document.getElementById("first").checked = true;
            });
            draw(coords_univ, images_univ, name_univ, short_form, "transparent"); //Draw circles and lines(line color based on the chosen field of interest)

        });

        //"Add layer" panel
        var wrapper = document.getElementById("wrapper");
        var ddm = document.getElementsByClassName("ddbutton");
        var su = document.getElementsByClassName("context");
        //Gets the dropdown menu options
        ddm[0].addEventListener("click", function() {
            su[1].innerHTML = "Startup Founders Age";
            su[2].innerHTML = "Female Startup Founders";
            su[3].innerHTML = "Male Startup Founders";
        });
        ddm[1].addEventListener("click", function() {
            su[1].innerHTML = "U-I Collaboration";
            su[2].innerHTML = "Company Spending on RD";
            su[3].innerHTML = "(another index)";
        });
        ddm[2].addEventListener("click", function() {
            su[1].innerHTML = "Researchers";
            su[2].innerHTML = "Female Researchers";
            su[3].innerHTML = "Male Researchers";
        });

        //Choropleth Map filling parameters
        var abbr = false; // Necessary to abbreviate legend of choropleth map? 
        var fillDefault = function(d) {
            legend_title = ""
            r = [0, 0];
            Scale = d3.scaleQuantize().domain(r).range(['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff']);
            dom = getLabels(r);
            return "#ffffff";
        }; // Parameters for choropleth map when "None" is selected in the "Add Layer" panel 
        var fillPopulation = function(d) {
            legend_title = "Population [millions]"
            r = getRange(population);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);

            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(population[i])
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Population" is selected in the "Add Layer" panel
        var fillIncome = function(d) {
            legend_title = "Income Per Capita [â‚¬]"
            r = getRange(income);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(income[i])
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Income per Capita" is selected in the "Add Layer" panel
        var fillSpending = function(d) {
            legend_title = "Spending on RD [% of GDP]"
            r = getRange(spending_rd);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(spending_rd[i])
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Spending on RD" is selected in the "Add Layer" panel
        var fillSFAge = function(d) {
            legend_title = "Average Age"
            r = getRange(sf_age);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(sf_age[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Startup Founders Age" is selected in the "Add Layer" panel
        var fillSFFem = function(d) {
            legend_title = "Females [%]"
            r = getRange(sf_female);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(sf_female[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Female Startup Founders" is selected in the "Add Layer" panel
        var fillSFMal = function(d) {
            legend_title = "Males [%]"
            r = getRange(sf_male);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(sf_male[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Male Startup Founders" is selected in the "Add Layer" panel
        var fillUIC = function(d) {
            legend_title = "U-I Collaboration [1-7]"
            //r = getRange("u_i_collaboration");
            r = [1, 7];
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(u_i_collaboration[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "U-I Collaboration" is selected in the "Add Layer" panel
        var fillCSpending = function(d) {
            legend_title = "Company Spending on RD [1-7]"
            //r = getRange("u_i_collaboration");
            r = [1, 7];
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(company_spending_rd[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Company Spending on RD" is selected in the "Add Layer" panel
        var fillNumRes = function(d) {
            legend_title = "Researchers Per Million"
            r = getRange(researchers_per_million);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(researchers_per_million[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Researchers" is selected in the "Add Layer" panel
        var fillFemRes = function(d) {
            legend_title = "Female Researchers Per Million"
            r = getRange(researcher_female);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(researcher_female[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Female Reserchears" is selected in the "Add Layer" panel
        var fillMalRes = function(d) {
            legend_title = "Male Researchers Per Million"
            r = getRange(researcher_male);
            Scale = d3.scaleQuantize().domain(r).range(['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d']);
            dom = getLabels(r);
            if (country.includes(d.properties.NAME_EN)) {
                for (i = 0; i < country.length; i++) {
                    if (country[i] == d.properties.NAME_EN) {
                        return Scale(researcher_male[i]);
                    }
                }
            } else {
                return "#ffffff";
            }
        }; //Parameters for choropleth map when "Male Researchers" is selected in the "Add Layer" panel

        //Dashboard 
        //Focus Field View - Buttons
        var fields = ["Entrepreneurship and Innovation", "Health and Bio Engineering", "Smart and Urban Mobility", "Data Science and Engineering", "High Performance Computing"]; // Fields of interest - taken from Eurotech's website
        var color_fields = ['#98C6EA', '#A2AD00', '#DAD7CB', '#E37222', '#387780']; //Color scale for fields of interest
        var colorsuni = ["#BCAA99", "#841C26", "#ED0000", "#94B9AF", "#90A583", "#0066CC"]; //Color scale for different universities - taken from their logos
        var selected = "initial"; // Default: no field of interest - Donut charts appear
        var ei_b = document.getElementById('ei_Button'); // Button "Entrepreneurship and Innovation"
        var hbe_b = document.getElementById('hbe_Button'); // Button "Health and Bio Engineering"
        var sum_b = document.getElementById('sum_Button'); // Button "Smart and Urban Mobility"
        var dse_b = document.getElementById('dse_Button'); // Button "Data Science and Engineering"
        var hpc_b = document.getElementById('hpc_Button'); // Button "High Performance Computing"
        var divsToHide = document.getElementById('statistical_charts'); //Variable used to hide charts when the field of interest is changed
        var chartsToHide = document.getElementsByClassName("mySlides fade"); //Variable used to hide charts if the user has not chosen a field of interest nor clicked on a point or line

        // When a "field of interest" button is clicked, the "selected" variable changes to update the charts in the collapsible menu, the function "adapt_button" highlights the button of the selected field of interest changing the opacity of the non-selected ones, and the function "adapt" updates the color of the lines in the map and of the title on the Statistics View
        ei_b.addEventListener('click', function(e) {
            n1 = "";
            selected = "ei";
            adapt_button(ei_b);
            adapt(fields[0], "#98C6EA");
        });
        hbe_b.addEventListener('click', function(e) {
            n1 = "";
            selected = "hbe";
            adapt_button(hbe_b);
            adapt(fields[1], "#A2AD00");
        });
        sum_b.addEventListener('click', function(e) {
            n1 = "";
            selected = "sum";
            adapt_button(sum_b);
            adapt(fields[2], "#DAD7CB");
        });
        dse_b.addEventListener('click', function(e) {
            n1 = "";
            selected = "dse";
            adapt_button(dse_b);
            adapt(fields[3], "#E37222");
        });
        hpc_b.addEventListener('click', function(e) {
            n1 = "";
            selected = "hpc";
            adapt_button(hpc_b);
            adapt(fields[4], "#387780");
        });

        //Statistics View
        var bt = document.getElementById('blockTitle'); //Title of the Statistics View: Universities selected    
        //Charts Container
        var coll = document.getElementsByClassName("section"); //Get the tabs
        var clickedtab = 0; // Variable that keeps track of the last tab clicked in order to update the charts
        var chart_titles = []; // Titles of charts 
        var slideIndex = 1; // Variable for sliders to see different charts 
        showSlides(slideIndex);
        var intro = document.getElementById("intro"); //Text on the box before graphs are presented
        //Define parameters of the Radar chart - Size, margin, and colors
        var margin = {
                top: 60,
                right: 0,
                bottom: 50,
                left: 0
            },
            width = Math.min(420, window.innerWidth * 0.38) - margin.left - margin.right,
            height = Math.min(width, window.innerHeight * 0.5 - margin.top - margin.bottom - 20);
        var radarChartOptions = {};
        var a = [],
            b = [],
            c = [],
            t = 0,
            n1 = "",
            n2 = ""; //Variables that stores the data to build the Radar chart
        var dataReady = []; //Variables that stores the data to build the Line chart
        var myColor = []; //Variables that stores colors to build the Line chart
        var mColor = []; //Variables that stores color to build the Line chart

        //Startups Tab 
        //Read "startup.json" File 
        var startup_list = TAFFY(startups);
        //Get the needed information for the Startups tab charts using SQL queries provided by TaffyDB
        //Create arrays containing the subfields of each of the fields of interest 
        var su_ei = startup_list().filter({
            field: fields[0]
        }).distinct("subfield");
        var su_hbe = startup_list().filter({
            field: fields[1]
        }).distinct("subfield");
        var su_sum = startup_list().filter({
            field: fields[2]
        }).distinct("subfield");
        var su_dse = startup_list().filter({
            field: fields[3]
        }).distinct("subfield");
        var su_hpc = startup_list().filter({
            field: fields[4]
        }).distinct("subfield");
        //Create array containing all universities
        var univs = startup_list().distinct("univ");
        
        //Create arrays containing annual turnover of startups working on each subfield within a field of interest, per university ("counter_attribute" function)
        var su_turnover_ei = counter_attribute(fields[0], su_ei, startup_list, "a_turnover");
        var su_turnover_hbe = counter_attribute(fields[1], su_hbe, startup_list, "a_turnover");
        var su_turnover_sum = counter_attribute(fields[2], su_sum, startup_list, "a_turnover");
        var su_turnover_dse = counter_attribute(fields[3], su_dse, startup_list, "a_turnover");
        var su_turnover_hpc = counter_attribute(fields[4], su_hpc, startup_list, "a_turnover");

        //Companies Tab
        //Read "companies.json" File 
        //var company_list = TAFFY ([companies]);

        //Research Centers Tab
        //Read "research.json" File 
        var rc_list = TAFFY(research);
        var pied = counter_field(); //Variable containing data for donut charts
        var pie = d3.pie().value(function(d) {
            return d;}) //Variable used to build the donut charts
        
        //Get the needed information for the Research Centers tab charts using SQL queries provided by TaffyDB
        var rc_investment_ei = counter_attribute(fields[0], su_ei, rc_list, "a_investment");
        var rc_investment_hbe = counter_attribute(fields[1], su_hbe, rc_list, "a_investment");
        var rc_investment_sum = counter_attribute(fields[2], su_sum, rc_list, "a_investment");
        var rc_investment_dse = counter_attribute(fields[3], su_dse, rc_list, "a_investment");
        var rc_investment_hpc = counter_attribute(fields[4], su_hpc, rc_list, "a_investment");

        // FUNCTIONS 
        // Functions for the dropdown menu on the Add layer panel
        function dropdownFunction() {
            document.getElementById("myDropdown").classList.toggle("show");
        }
        window.onclick = function(event) {
            if (!event.target.matches('.dropbtn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                var i;
                for (i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
        //Function to display content when clicking on the tabs on the Statistics View - Charts are updated when clicking on another tab
        function openTab(evt, tabName) {
            if (selected != "initial") {
                dataReady = [];
                if (tabName == 'Startups') {
                    clickedtab = 1;
                    chart_titles = ["Annual Turnover [Mâ‚¬]", "Evolution since 2012", "NÂ° of Startups"];
                    if (n1 != "") {
                        if (n2 != "") {
                            draw_r([addition(a, b, n1, n2), spider_chart(a, b, n1), spider_chart(a, b, n2)]);
                            dataReady.push(line_chart(fields[t], n1, startup_list), line_chart(fields[t], n2, startup_list));
                            draw_l(dataReady, myColor);
                        } else {
                            draw_r([spider_chart(a, b, n1)]);
                            dataReady.push(line_chart(fields[t], n1, startup_list));
                            draw_l(dataReady, mColor);
                        }
                    }
                } else if (tabName == 'Companies') {
                    clickedtab = 2;
                    chart_titles = ["TuVieja", "TuVieja", "TuVieja"];
                } else {
                    clickedtab = 3;
                    chart_titles = ["Annual Investment [Mâ‚¬]", "Evolution since 2012", "NÂ° of Agreements"];
                    if (n1 != "") {
                        if (n2 != "") {
                            draw_r([addition(a, c, n1, n2), spider_chart(a, c, n1), spider_chart(a, c, n2)]);
                            dataReady.push(line_chart(fields[t], n1, rc_list), line_chart(fields[t], n2, rc_list));
                            draw_l(dataReady, myColor);
                        } else {
                            draw_r([spider_chart(a, c, n1)]);
                            dataReady.push(line_chart(fields[t], n1, rc_list));
                            draw_l(dataReady, mColor);
                        }
                    }
                }
            }
            var i, tabcontent, section;
            tabcontent = document.getElementsByClassName("content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            section = document.getElementsByClassName("section");
            for (i = 0; i < section.length; i++) {
                section[i].className = section[i].className.replace(" active", "");
            }
            document.getElementById("statistical_charts").style.display = "block";
            evt.currentTarget.className += " active";
        }
        //Functions for sliders used to see the different charts on the Statistics View
        function plusSlides(n) {
            showSlides(slideIndex += n);
        }
        function showSlides(n) {
            var i;
            var slides = document.getElementsByClassName("mySlides");
            if (n > slides.length) {
                slideIndex = 1
            }
            if (n < 1) {
                slideIndex = slides.length
            }
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            slides[slideIndex - 1].style.display = "block";

        }
        //Function to draw the basemap and its elements 
        function drawMap(data, fillFunction) {

            var mapx = d3.select('.map .mapRoot')
                .selectAll('path')
                .data(data);
            mapx.enter()
                .append('path')
                .attr("fill", fillFunction)
                .attr("opacity", 0.5)
                .attr("d", pathGenerator)
                .attr("class", "mappath");
            mapx.enter()
                .append("rect")
                .attr("x", 503)
                .attr("y", 260)
                .attr("width", 62)
                .attr("height", 40)
                .attr("fill", "#f8f8f8")
                .attr("class", "legcirc");
            mapx.enter()
                .append("rect")
                .attr("x", 558)
                .attr("y", 252)
                .attr("width", 7)
                .attr("height", 34)
                .attr("fill", "#f8f8f8")
                .attr("class", "legboxcirc");
            mapx.enter()
                .append("rect")
                .attr("x", 325)
                .attr("y", 263)
                .attr("width", 54)
                .attr("height", 35)
                .attr("fill", "#ffffff")
                .attr("class", "legbox");

            var selec = d3.select(".map .mapRoot")
                .selectAll("path")
                .data(data);

            // what to do with NEW elements
            selec.enter()
                .attr("fill", fillFunction);

            // what to do with EXISTING elements
            selec
                .transition()
                .duration(800)
                .attr("fill", fillFunction);

            d3.select('.map .mapRoot').selectAll(".text").remove();
            var dm = [];
            for (i = 0; i < dom.length; i++) {
                if (abbr == false) {
                    dm[i] = Number(Math.round(dom[i] + 'e1') + 'e-1');
                } else {
                    dm[i] = Number(Math.round(dom[i] / 1000 + 'e1') + 'e-1');
                }
            }

            if (abbr == false) {
                dm[5] = Number(Math.round(r[1] + 'e1') + 'e-1');
                legend_labels = [dm[0] + " - " + dm[1], dm[1] + " - " + dm[2], dm[2] + " - " + dm[3], dm[3] + " - " + dm[4], dm[4] + " - " + dm[5]];
            } else {
                dm[5] = Number(Math.round(r[1] / 1000 + 'e1') + 'e-1');
                legend_labels = [dm[0] + "K - " + dm[1] + "K", dm[1] + "K - " + dm[2] + "K", dm[2] + "K - " + dm[3] + "K", dm[3] + "K - " + dm[4] + "K", dm[4] + "K - " + dm[5] + "K"];
            }


            var legend = d3.select(".map .mapRoot")
                .selectAll("g.legend")
                .data(dom)
                .enter().append("g");

            d3.select('.map .mapRoot').selectAll(".leg").remove();
            legend.append("rect")
                .attr("x", 328)
                .attr("y", function(d, i) {
                    return (i * ls_h + 272);
                })
                .attr("width", ls_w)
                .attr("height", ls_h)
                .attr("stroke", "#000000")
                .attr("stroke-width", 0.3)
                .attr("class", "leg")
                .style("fill", function(d, i) {
                    return Scale(d);
                })
                .style("opacity", 0.5);

            /*legend.append("text")
                .attr("x", 328)
                .attr("y", 265)
                .text("Legend")
                .style("font-size", "3.5px")
                .attr("class", "text");*/

            legend.append("text")
                .attr("x", 328)
                .attr("y", 269)
                .text(legend_title)
                .style("font-size", "3.6px")
                .attr("class", "text");

            legend.append("text")
                .attr("x", 335)
                .attr("y", function(d, i) {
                    return (i * ls_h + 272) + (ls_h / 2 + 1.5);
                })
                .text(function(d, i) {
                    return legend_labels[i];
                })
                .style("font-size", "3.5px")
                .attr("class", "text");

            if (r[1] == 0) {
                d3.select('.map .mapRoot').selectAll(".legbox").style("stroke-width", 0);
                d3.select('.map .mapRoot').selectAll(".legbox").style("fill", "transparent");
                d3.select('.map .mapRoot').selectAll(".leg").remove();
                d3.select('.map .mapRoot').selectAll(".text").remove();
            } else {
                d3.select('.map .mapRoot').selectAll(".legbox").style("stroke-width", 0.3);
                d3.select('.map .mapRoot').selectAll(".legbox").style("fill", "#f8f8f8")
            }
        }
        //Function to draw elements on the map such as the universities, links between them, donut charts and proportional circles, etc - Updates the legend and parameters when the user zooms in and out  
        function draw(data, img, name, sf, color) {
            doExit(); //Erases existing circles and lines - Necessary when the user changes the field of interest
            d3.select('.map .mapRoot').selectAll('path').transition().duration(400).style("stroke-width", 0.25);

            legend_right = d3.select(".map .mapRoot")
                .selectAll("g.legend")
                .data(fields)
                .enter().append("g");

            // Draw lines
            var link = [];
            k = 0;
            n = coords_univ.length - 1;
            while (k < n) {
                for (i = k; i < n; i++) {
                    topush = {
                        type: "LineString",
                        coordinates: [
                            coords_univ[k],
                            coords_univ[i + 1]
                        ],
                        name1: short_form[k],
                        name2: short_form[i + 1]
                    }
                    link.push(topush)
                }
                k++;
            }
            lines = d3.select(".map .mapRoot")
                .selectAll("myPath")
                .data(link)
                .enter()
                .append("path")
                .attr("class", "line")
                .attr("d", function(d) {
                    return pathGenerator(d)
                });
            lines.style("fill", "none")
                .style("stroke", color)
                .style("stroke-width", 1)

                //When a line is clicked: zoom in to the line, hide all the other lines and circles, change the title in the Statistics View (using the color of the selected field of interest) und update charts in the collapsible panel (function "filter")
                .on("click", zoomToObject)

            //Points
            points = d3.select(".map .mapRoot")
                .selectAll("image")
                .data(data)
                .enter()
                .append("svg:image")
                .attr("class", "image")
                .attr("x", function(d) {
                    return projection(d)[0] - 8;
                })
                .attr("y", function(d) {
                    return projection(d)[1] - 8;
                });

            points.attr('width', 16)
                .attr('height', 16)
                .attr("xlink:href", function(d) {
                    return img[data.indexOf(d)];

                })
                .attr("opacity", 1)
                .on("click", zoomToObject)

            circles = d3.select(".map .mapRoot")
                .selectAll("circle")
                .data(coords_univ);

            var svg = d3.select(".map .mapRoot").append("g")
                .selectAll("g")
                .data(pied)
                .enter()
                .append("g")
                .attr("transform", function(d) {
                    return "translate(" + projection([d.lon, d.lat]) + ")"
                })
                .attr("class", "pies")
                .attr("opacity", 1)

            // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.

            var pies = svg.selectAll(".pies")
                .data(function(d) {
                    return pie(d.data.split(['-']));
                })
                .enter()
                .append('g')
                .attr('class', 'arc');

            if (selected == "initial") {

                pies.append("path")
                    .attr('d', arc)
                    .attr("fill", function(d, i) {
                        return color_fields[i];
                    })
                    .style("stroke", "transparent")
                    .style("stroke-width", "1px");

                pies.transition()
                    .duration(800)
                    .attr("d", arc);

                legend_right.append("rect")
                    .attr("x", 503)
                    .attr("y", function(d, i) {
                        return (i * (ls_h + 3) + 262);
                    })
                    .attr("width", ls_w)
                    .attr("height", ls_h)
                    .attr("stroke", function() {
                        return "#000000"
                    })
                    .attr("stroke-width", 0.3)
                    .attr("class", "legcirc")
                    .style("fill", function(d, i) {
                        return color_fields[i];
                    })
                    .style("opacity", 1);

                legend_right.append("text")
                    .attr("x", 510)
                    .attr("y", function(d, i) {
                        return (i * (ls_h + 3) + 262) + ((ls_h) / 2 + 1.5);
                    })
                    .text(function(d, i) {
                        return fields[i].replace('and', '&');
                    })
                    .style("font-size", "4px")
                    .attr("class", "textcirc");
            } else {
                d3.select('.map .mapRoot').selectAll(".textcirc").remove();
                d3.select('.map .mapRoot').selectAll(".legcirc").remove();
                d3.select('.map .mapRoot').selectAll(".cir").remove();
                d3.select('.map .mapRoot').selectAll(".texcir").remove();
                legend_right.append("text")
                    .attr("x", 528)
                    .attr("y", 301)
                    .text("NÂ° of entities")
                    .style("font-size", "3px")
                legend_right.append("text")
                    .attr("x", 523)
                    .attr("y", 304)
                    .text("working on this field")
                    .style("font-size", "3px")
                
                legend_right.append("circle")
                    .attr("cy", function(d, i) {
                        return 297 - range[i];
                    })
                    .attr("cx", 537)
                    .attr("r", function(d, i) {
                        return range[i];
                    })
                    .attr("fill", color)
                    .attr("fill-opacity", function(d, i) {
                        if (i == 0) {
                            return 0.8
                        } else {
                            return 0
                        }
                    })
                    .attr("stroke", "black")
                    .attr("stroke-width", 0.2)
                    .attr("class", "cir");

                legend_right.append("line")
                    .attr("x1", 537)
                    .attr("y1", function(d, i) {
                        return 297 - (range[i] * 2);
                    })
                    .attr("x2", 557)
                    .attr("y2", function(d, i) {
                        return 320 - (range[i] * 4);
                    })
                    .attr("stroke", function(d, i) {

                        return "black"

                    })
                    .attr("stroke-width", 0.3)
                    .attr("class", "texcir");

                legend_right.append("text")
                    .attr("x", 559)
                    .attr("y", function(d, i) {
                        return 320 - (range[i] * 4);
                    })
                    .text(function(d, i) {
                        if (range[i] != range[i - 1]) {
                            return label[i];
                        }
                    })
                    .attr("font-size", "4px")
                    .attr("class", "texcir");

            }


            function reset() {
                active.classed("active", false);
                active = d3.select(null);
                scale_circles(16, 0.5, 0.25);
                d3.select(".map ").transition()
                    .duration(1200)
                    .call(zoom.transform, d3.zoomIdentity);
                lines.transition('B')
                    .duration(200)
                    .attr("opacity", 1);
                points.transition('B')
                    .duration(200)
                    .attr("opacity", 1);
            }


            function zoomToObject(d, i) {

                // if path is already the selected one, reset zoom
                if (active.node() === this) {
                    d3.select('.map .mapRoot').selectAll(".mappath").attr("opacity", 0.5);
                    if (selected == "initial") {
                        d3.select('.map .mapRoot').selectAll(".pies").transition().duration(2200).attr("opacity", 1);
                    } else {
                        d3.select('.map .mapRoot').selectAll(".p_circles").transition().duration(2200).attr("opacity", 1);
                    }
                    reset();
                    scale_circles(16, 0.5, 0.25);
                    contextOn();
                    intro.style.display = "block";
                    bt.innerHTML = "";
                    for (var i = 0; i < chartsToHide.length; i++) {
                        coll[i].classList.remove("active");
                        chartsToHide[i].style.visibility = "hidden";

                    }

                    return;
                }


                contextOff();
                d3.select('.map .mapRoot').selectAll(".mappath").attr("opacity", 0.2);

                // toggle "active" class from old to new selection
                active.classed("active", false);
                active = d3.select(this).classed("active", true);

                if (d.length == 2) {
                    // calculate zoom bounds

                    n1 = univs[coords_univ.indexOf(d)];
                    n2 = "";
                    filter_p(n1);

                    d3.select('.map .mapRoot').selectAll(".pies").transition().duration(200).attr("opacity", 0);
                    d3.select('.map .mapRoot').selectAll(".p_circles").transition().duration(200).attr("opacity", 0);
                    dx = 50,
                        dy = 50,
                        x = projection(d)[0] + 12.5,
                        y = projection(d)[1] + 32.5,
                        scale = 12,
                        translate = [width_map / 2 - scale * x, height_map / 2 - scale * y];

                    scale_circles(3, 0.1, 0.1);

                } else {

                    n1 = link[i].name1;
                    n2 = link[i].name2;

                    filter(n1, n2);
                    bt.style.color = color;
                    scale_circles(16, 0.5, 0.25);
                    lines
                        .each(function(d, i) {
                            var header = d3.select(this);
                            if (link[i].name1 != n1 || link[i].name2 != n2) {
                                header.transition('A')
                                    .duration(200)
                                    .attr("opacity", 0);
                            }
                        });

                    points
                        .each(function(d, i) {
                            var header = d3.select(this);
                            if (sf[i] != n1 && sf[i] != n2) {
                                header.transition('A')
                                    .duration(200)
                                    .attr("opacity", 0);
                            }
                        });
                    if (selected != "initial") {
                        circles
                            .each(function(d, i) {
                                var head = d3.select(this);
                                if (sf[i] != n1 && sf[i] != n2) {
                                    head.transition()
                                        .duration(200)
                                        .attr("opacity", 0);
                                } else {
                                    head.transition()
                                        .duration(200)
                                        .attr("opacity", 1);
                                }
                            });
                    }
                    // calculate zoom bounds
                    var bounds = pathGenerator.bounds(d),
                        dx = bounds[1][0] - bounds[0][0],
                        dy = bounds[1][1] - bounds[0][1],
                        x = (bounds[0][0] + bounds[1][0]) / 2 + 75,
                        y = (bounds[0][1] + bounds[1][1]) / 2 + 195,
                        scale = 2,
                        translate = [width_map / 2 - scale * x, height_map / 2 - scale * y];


                }

                if (selected != "initial") {
                    for (i = 0; i < chartsToHide.length; i++) {
                        chartsToHide[i].style.visibility = "visible";
                    }
                    intro.style.display = "none";
                }
                // animate transform attribute of map element
                d3.select(".map").transition()
                    .duration(1200)
                    .call(zoom.transform, d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale));
            }

        }
        //Function to erase existing elements on the map - Necessary when the user changes the field of interest
        function doExit() {
            d3.select('.map .mapRoot').selectAll(".image").remove();
            d3.select('.map .mapRoot').selectAll(".line").remove();
        }
        //Function called when a line is clicked: updates title of the Statistics View and the charts on it
        function filter(n1, n2) {

            width = Math.max(420, window.innerWidth * 0.35) - margin.left - margin.right,
                height = Math.min(width, window.innerHeight * 0.55) - margin.top - margin.bottom;

            bt.innerHTML = n1 + '-' + n2;
            if (selected == "ei") {
                a = su_ei;
                b = su_turnover_ei;
                c = rc_investment_ei;
                t = 0;
            } else if (selected == "hbe") {
                a = su_hbe;
                b = su_turnover_hbe;
                c = rc_investment_hbe;
                t = 1;
            } else if (selected == "sum") {
                a = su_sum;
                b = su_turnover_sum;
                c = rc_investment_sum;
                t = 2;
            } else if (selected == "dse") {
                a = su_dse;
                b = su_turnover_dse;
                c = rc_investment_dse;
                t = 3;
            } else if (selected == "hpc") {
                a = su_hpc;
                b = su_turnover_hpc;
                c = rc_investment_hpc;
                t = 4;
            }

            k = short_form.indexOf(n1);
            l = short_form.indexOf(n2);
            color = d3.scaleOrdinal().range([colorsuni[0], colorsuni[k + 1], colorsuni[l + 1]]);
            radarChartOptions = {
                w: width,
                h: height,
                margin: margin,
                maxValue: 0.5,
                levels: 5,
                roundStrokes: true,
                color: color
            }

            allGroup = [n1, n2];
            dataReady = [];
            myColor = [colorsuni[k + 1], colorsuni[l + 1]];

            if (clickedtab == 1) {
                draw_r([addition(a, b, n1, n2), spider_chart(a, b, n1), spider_chart(a, b, n2)]);
                dataReady.push(line_chart(fields[t], n1, startup_list), line_chart(fields[t], n2, startup_list));
                draw_l(dataReady, myColor);
            }
            if (clickedtab == 3) {
                draw_r([addition(a, c, n1, n2), spider_chart(a, c, n1), spider_chart(a, c, n2)]);
                dataReady.push(line_chart(fields[t], n1, rc_list), line_chart(fields[t], n2, rc_list));
                draw_l(dataReady, myColor);
            }

            if (selected != "initial") {
                document.getElementById("arr_p").style.visibility = "visible";
                document.getElementById("arr_n").style.visibility = "visible";
            }
        }
        //Function called when a line is clicked: updates title of the Statistics View and the charts on it
        function filter_p(n1) {
            width = Math.max(420, window.innerWidth * 0.35) - margin.left - margin.right,
                height = Math.min(width, window.innerHeight * 0.55) - margin.top - margin.bottom;

            bt.innerHTML = n1;
            if (selected == "ei") {
                a = su_ei;
                b = su_turnover_ei;
                c = rc_investment_ei;
                t = 0;
            } else if (selected == "hbe") {
                a = su_hbe;
                b = su_turnover_hbe;
                c = rc_investment_hbe;
                t = 1;
            } else if (selected == "sum") {
                a = su_sum;
                b = su_turnover_sum;
                c = rc_investment_sum;
                t = 2;
            } else if (selected == "dse") {
                a = su_dse;
                b = su_turnover_dse;
                c = rc_investment_dse;
                t = 3;
            } else if (selected == "hpc") {
                a = su_hpc;
                b = su_turnover_hpc;
                c = rc_investment_hpc;
                t = 4;
            }

            k = short_form.indexOf(n1);

            color = d3.scaleOrdinal().range([colorsuni[k + 1]]);

            radarChartOptions = {
                w: width,
                h: height,
                margin: margin,
                maxValue: 0.5,
                levels: 5,
                roundStrokes: true,
                color: color
            };

            allGroup = [n1];
            dataReady = [];
            mColor = [colorsuni[k + 1]];

            if (clickedtab == 1) {
                draw_r([spider_chart(a, b, n1)]);
                dataReady.push(line_chart(fields[t], n1, startup_list));
                draw_l(dataReady, mColor);
            }
            if (clickedtab == 3) {
                draw_r([spider_chart(a, c, n1)]);
                dataReady.push(line_chart(fields[t], n1, rc_list));
                draw_l(dataReady, mColor);
            }

            if (selected != "initial") {
                document.getElementById("arr_p").style.visibility = "visible";
                document.getElementById("arr_n").style.visibility = "visible";
            }
        }
        //Function to zoom in
        function zoomed() {
            // d3.event will contain the transformation calculated for us
            d3.select(".map .mapRoot").attr("transform", d3.event.transform);
        }
        //Function to rescale circles when zooming in and out (thickness of lines are changed as well)
        function scale_circles(size_px, str_w, str_map) {
            arc_new = d3.arc()
                .innerRadius(16 * str_w)
                .outerRadius(24 * str_w);

            d3.select(".map .mapRoot").selectAll("image").transition().duration(1200).attr('width', size_px).attr('height', size_px).attr("x", function(d) {
                    return projection(d)[0] - size_px / 2;
                })
                .attr("y", function(d) {
                    return projection(d)[1] - size_px / 2;
                });

            //d3.select('.map .mapRoot').selectAll('.p_circles')
            d3.select('.map .mapRoot').selectAll('path').transition().duration(1200).style("stroke-width", str_map);
            d3.select('.map .mapRoot').selectAll('.line').transition().duration(1200).style("stroke-width", str_w * 2);
        }
        //Functions to display or hide the Add layer panel depending on zoom level
        function contextOn() {
            wrapper.style.visibility = "visible";
        }

        function contextOff() {
            wrapper.style.visibility = "hidden";
        }
        //Function to get the range of the data for the choropleth map 
        function getRange(ind) {
            min = Math.min(...ind);
            max = Math.max(...ind);
            if (max > 1000) {
                abbr = true;
            } else {
                abbr = false;
            }
            return [Number(Math.round(min + 'e1') + 'e-1'), Number(Math.round(max + 'e1') + 'e-1')];
        }
        //Function to get the labels for the choropleth map legend
        function getLabels(r) {
            dom = [r[0], r[0] + (r[1] - r[0]) / 5, r[0] + (r[1] - r[0]) * 2 / 5, r[0] + (r[1] - r[0]) * 3 / 5, r[0] + (r[1] - r[0]) * 4 / 5];
            leg = [];
            for (i = 0; i < dom.length; i++) {
                push = Number(Math.round(dom[i] + 'e1') + 'e-1');
                leg.push(push);
            }
            return leg;
        }
        //Function that updates parameters of the Statistics View depending on the chosen field of interest (e.g.: highlights the button of the selected field of interest changing the opacity of the non-selected ones)
        function adapt_button(but) {
            active.classed("active", false);
            active = d3.select(null);
            d3.select(".map ").transition()
                .duration(1200)
                .call(zoom.transform, d3.zoomIdentity);
            scale_circles(16, 0.5, 0.5);
            contextOn();
            su[1].innerHTML = "Population";
            su[2].innerHTML = "Income per Capita";
            su[3].innerHTML = "Spending on RD";
            document.getElementById("first").checked = true;
            d3.select('.map .mapRoot').selectAll(".mappath").attr("opacity", 0.5);
            d3.select('.map .mapRoot').selectAll(".p_circles").attr("opacity", 1);
            for (var i = 0; i < coll.length; i++) {
                coll[i].classList.remove("active");
            }
            for (var i = 0; i < chartsToHide.length; i++) {
                chartsToHide[i].style.visibility = "hidden";
            }
            bt.innerHTML = "";
            divsToHide.style.display = "none";
            intro.style.display = "block";
            intro.innerHTML = "Choose a line or a point in the map to get information";
            but.style.opacity = 1;
            var buttons = document.getElementsByClassName("field_button");
            for (i = 0; i < buttons.length; i++) {
                if (buttons[i] != but) {
                    buttons[i].style.opacity = 0.5;
                }
            }
        };
        //Function that updates parameters of the Map View depending on the chosen field of interest (e.g.:updates the proportional circles, the color of the lines in the map and of the title on the Statistics View)
        function adapt(f, color) {
            bt.style.color = color;
            rad = [];
            count = [];
            for (i = 0; i < univs.length; i++) {
                temp_su = startup_list().filter({
                    field: f
                }).filter({
                    univ: univs[i]
                }).count();
                temp_rc = rc_list().filter({
                    field: f
                }).filter({
                    univ: univs[i]
                }).count();
                temp = temp_su + temp_rc;
                count.push(temp);
                
            }
            min = Math.min(...count);
            max = Math.max(...count);
            for (i = 0; i < count.length; i++) {
                temp = Math.round((count[i]-min)*4/(max-min) + 8)
                rad.push(temp)
            }

            label = count.sort(function(a, b) {
                return b - a
            });


            // what to do with NEW elements
            circles.enter()
                .append("circle")
                .attr("fill-opacity", 0.8)
                .attr("fill", color)
                .attr("class", "p_circles")
                .attr("cx", function(d) {
                    return projection(d)[0];
                })
                .attr("cy", function(d) {
                    return projection(d)[1];
                })
                .attr("r", function(d, i) {
                    return rad[i];
                });

            // what to do with EXISTING elements
            circles
                .transition()
                .duration(400)
                .attr("fill-opacity", 0.8)
                .attr("fill", color)
                .attr("r", function(d, i) {
                    return rad[i];
                });
            range = rad.sort(function(a, b) {
                return b - a
            });
            draw(coords_univ, images_univ, name_univ, short_form, color);
            d3.select('.map .mapRoot').selectAll(".pies").transition().duration(400).attr("opacity", 0);

        };
        //Function that creates data necessary for the DonutChart that appear at the beginning
        function counter_field() {
            var count = [];
            var sum = [];
            var donut = [];
            k = 0;
            while (k < univs.length) {
                for (i = 0; i < fields.length; i++) {
                    temp_su = startup_list().filter({
                        field: fields[i]
                    }).filter({
                        univ: univs[k]
                    }).count();
                    temp_rc = rc_list().filter({
                        field: fields[i]
                    }).filter({
                        univ: univs[k]
                    }).count();
                    temp= temp_su + temp_rc;
                    if (i != 0) {
                        count += "-" + temp;
                    } else {
                        count += temp
                    }
                }
                topush = {
                    data: count,
                    lon: coords_univ[k][0],
                    lat: coords_univ[k][1]
                }
                donut.push(topush);
                topush = [];
                count = [];
                k++;
            }


            return donut;
        }
        //Function that creates data necessary for the RadarChart
        function counter_attribute(field, sf_arr, list, attribute) {
            var count = [];
            var sum = [];
            k = 0;
            while (k < sf_arr.length) {
                for (i = 0; i < univs.length; i++) {
                    temp = list().filter({
                        field: field
                    }).filter({
                        subfield: sf_arr[k]
                    }).filter({
                        univ: univs[i]
                    }).sum(attribute);
                    count.push(temp);
                }
                sum[k] = count;
                count = [];
                k++;
            }
            return sum;
        }
        //Functions that prepares the data needed to build the "Radar Chart" 
        function spider_chart(subf, univ_field, uni) {
            var spider = [];
            k = short_form.indexOf(uni);

            for (i = 0; i < subf.length; i++) {
                topush = {
                    "axis": subf[i],
                    "value": univ_field[i][k],
                    "univ": uni
                }
                spider.push(topush)
            }
            return spider;
        } // Data for each university
        function addition(subf, univ_field, a, b) {
            var spider = [];
            k = short_form.indexOf(a);
            l = short_form.indexOf(b);

            var add = [];

            for (i = 0; i < univ_field.length; i++) {
                temp = univ_field[i][k] + univ_field[i][l];
                add.push(temp);
            }

            for (i = 0; i < subf.length; i++) {
                topush = {
                    "axis": subf[i],
                    "value": add[i],
                    "univ": "Total"
                }
                spider.push(topush)
            }
            return spider;
        } // Sum of both when a line is clicked
        //Function that prepares the data needed to build the "Line Chart" 
        function line_chart(field, uni, list) {

            var num_su = [];
            var dataline = [];

            year_range = [2012, 2013, 2014, 2015, 2016, 2017, 2018];
            k = 0;
            w = 0;

            for (i = 0; i < year_range.length; i++) {
                if (i == 0) {
                    p = list().filter({
                        univ: uni
                    }).filter({
                        field: field
                    }).min("f_year");
                    for (j = p; j <= year_range[0]; j++) {
                        u = list().filter({
                            univ: uni
                        }).filter({
                            field: field
                        }).filter({
                            f_year: j
                        }).count();
                        w += u;
                    }
                } else {
                    w = list().filter({
                        univ: uni
                    }).filter({
                        field: field
                    }).filter({
                        f_year: year_range[i]
                    }).count();
                }
                k += w;

                temp = {
                    "year": year_range[i],
                    "value": k
                }
                num_su.push(temp);


            }
            dataline = {
                "name": uni,
                "values": num_su
            };

            return dataline;
        }
        //Call function to draw the Radar chart
        function draw_r(data) {
            RadarChart("#su_radar_chart", data, radarChartOptions, chart_titles[0]);
        }
        //Call function to draw the Line chart
        function draw_l(dataReady, myColor) {
            d3.select("#su_line_chart").select("svg").remove();
            var margin = {
                    top: 70,
                    right: 70,
                    bottom: 30,
                    left: 70
                },
                widthb = width * 2 / 3;

            // append the svg object to the body of the page    
            var svg = d3.select("#su_line_chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // Add X axis 
            var x = d3.scaleLinear()
                .domain([2012, 2018])
                .range([0, widthb]);


            svg.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", "translate(0," + height * 0.95 + ")")
                .call(d3.axisBottom(x).ticks(6)
                    .tickFormat(function(d) {
                        return d;
                    }));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([0, 40])
                .range([height * 0.9, 0]);

            svg.append("g")
                .attr("class", "grid")
                .call(d3.axisLeft(y)
                    .tickSize(-widthb)
                    .tickFormat("")
                    .ticks(10)
                );
            svg.append("g")
                .attr("class", "axis axis--y")
                .call(d3.axisLeft(y).ticks(6))
                .append("text")
                .attr("class", "axis-title")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .text(chart_titles[2]);

            // Add the lines
            var line = d3.line()
                .x(function(d) {
                    return x(+d.year)
                })
                .y(function(d) {
                    return y(+d.value)
                })
            svg.selectAll("myLines")
                .data(dataReady)
                .enter()
                .append("path")
                .attr("d", function(d) {
                    return line(d.values)
                })
                .attr("stroke", function(d, i) {
                    return myColor[i]
                })
                .style("stroke-width", 4)
                .style("fill", "none")
                .attr("opacity", 0.7)


            // Add the points
            svg
                // First we need to enter in a group
                .selectAll("myDots")
                .data(dataReady)
                .enter()
                .append('g')
                .style("fill", function(d, i) {
                    return myColor[i]
                })
                // Second we need to enter in the 'values' part of this group
                .selectAll("myPoints")
                .data(function(d) {
                    return d.values
                })
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    return x(d.year)
                })
                .attr("cy", function(d) {
                    return y(d.value)
                })
                .attr("r", 5)
                .attr("opacity", 0.7)


            // Add a legend at the end of each line
            svg
                .selectAll("myLabels")
                .data(dataReady)
                .enter()
                .append('g')
                .append("text")
                .datum(function(d) {
                    return {
                        name: d.name,
                        value: d.values[d.values.length - 1]
                    };
                }) // keep only the last value of each time series
                .attr("transform", function(d) {
                    return "translate(" + x(d.value.year) + "," + y(d.value.value) + ")";
                }) // Put the text at the position of the last point
                .attr("x", 12) // shift the text a bit more right
                .text(function(d) {
                    return d.name;
                })
                .style("fill", function(d, i) {
                    return myColor[i]
                })
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .attr("opacity", 0.7)

            svg.append("text")
                .attr("x", widthb * 0.3)
                .attr("y", -(height * 0.15))
                .text(chart_titles[1])
                .style("font-size", "14px");

        }

    </script>
</body>

</html>
